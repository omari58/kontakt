<!DOCTYPE html>
<html lang="en" class="{{themeClass}}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{og.title}} | Kontakt</title>

  {{#if noIndex}}
  <meta name="robots" content="noindex, nofollow">
  {{/if}}

  <!-- OpenGraph -->
  <meta property="og:title" content="{{og.title}}">
  <meta property="og:description" content="{{og.description}}">
  <meta property="og:url" content="{{og.url}}">
  <meta property="og:type" content="{{og.type}}">
  {{#if og.image}}
  <meta property="og:image" content="{{og.image}}">
  {{/if}}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="{{og.title}}">
  <meta name="twitter:description" content="{{og.description}}">
  {{#if og.image}}
  <meta name="twitter:image" content="{{og.image}}">
  {{/if}}

  <!-- Structured Data -->
  <script type="application/ld+json">{{{jsonLd}}}</script>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600&family=DM+Serif+Display&display=swap" rel="stylesheet">
  {{#if fontUrl}}
  <link href="{{fontUrl}}" rel="stylesheet">
  {{/if}}

  <style>
    :root {
      {{cssVars}};
      --avatar-size: 104px;
      --card-radius: 24px;
      --font-body: 'Outfit', -apple-system, BlinkMacSystemFont, sans-serif;
      --primary-soft: color-mix(in srgb, var(--primary-color, #0066cc) 10%, var(--bg-color, #ffffff));
      --primary-medium: color-mix(in srgb, var(--primary-color, #0066cc) 18%, var(--bg-color, #ffffff));
      --divider: color-mix(in srgb, var(--text-color, #1a1a1a) 10%, var(--bg-color, #ffffff));
      --text-secondary: color-mix(in srgb, var(--text-color, #1a1a1a) 65%, var(--bg-color, #ffffff));
      --text-tertiary: color-mix(in srgb, var(--text-color, #1a1a1a) 45%, var(--bg-color, #ffffff));
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      background-color: var(--bg-color, #f5f5f5);
      color: var(--text-color, #1a1a1a);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 32px 16px 120px;
    }

    html.theme-dark body {
      background-color: var(--bg-color, #111);
      color: var(--text-color, #f0f0f0);
    }

    /* ===== Card shell ===== */
    .card {
      max-width: 460px;
      width: 100%;
      background: var(--bg-color, #ffffff);
      border-radius: var(--card-radius);
      overflow: hidden;
      box-shadow:
        0 0 0 1px rgba(0,0,0,0.03),
        0 2px 4px rgba(0,0,0,0.02),
        0 8px 24px rgba(0,0,0,0.06),
        0 24px 48px rgba(0,0,0,0.04);
      position: relative;
      animation: cardIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    html.theme-dark .card {
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.06),
        0 8px 24px rgba(0,0,0,0.3),
        0 24px 48px rgba(0,0,0,0.2);
    }

    {{#if card.bgImagePath}}
    body {
      background-image: url('{{card.bgImagePath}}');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
    }
    {{/if}}

    @keyframes cardIn {
      from {
        opacity: 0;
        transform: translateY(16px) scale(0.98);
      }
    }

    /* ===== Banner ===== */
    .card__banner {
      width: 100%;
      height: 180px;
      background: linear-gradient(135deg, var(--primary-color, #0066cc), color-mix(in srgb, var(--primary-color, #0066cc) 70%, black));
      overflow: hidden;
      position: relative;
    }

    .card__banner img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .card__banner::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: linear-gradient(to top, rgba(0,0,0,0.12), transparent);
      pointer-events: none;
    }

    /* ===== Profile ===== */
    .card__profile {
      padding: 0 28px 28px;
      text-align: center;
      margin-top: -52px;
      position: relative;
      z-index: 1;
    }

    .card__avatar {
      width: var(--avatar-size);
      height: var(--avatar-size);
      border: 4px solid var(--bg-color, #ffffff);
      object-fit: cover;
      display: inline-block;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    .card__avatar.circle { border-radius: 50%; }
    .card__avatar.rounded-square { border-radius: 20px; }

    .card__avatar-ph {
      width: var(--avatar-size);
      height: var(--avatar-size);
      border: 4px solid var(--bg-color, #ffffff);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary-color, #0066cc), color-mix(in srgb, var(--primary-color, #0066cc) 70%, black));
      color: white;
      font-family: var(--font-display);
      font-size: 40px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
    }

    .card__avatar-ph.circle { border-radius: 50%; }
    .card__avatar-ph.rounded-square { border-radius: 20px; }

    .card__name {
      font-family: var(--font-display);
      font-size: 28px;
      font-weight: 400;
      margin-top: 16px;
      line-height: 1.15;
      letter-spacing: -0.01em;
      animation: fadeUp 0.5s 0.15s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    .card__role {
      font-size: 15px;
      font-weight: 400;
      color: var(--text-secondary);
      margin-top: 6px;
      line-height: 1.4;
      animation: fadeUp 0.5s 0.2s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    .card__role strong {
      font-weight: 500;
      color: var(--text-color);
    }

    .card__bio {
      font-size: 14px;
      line-height: 1.65;
      color: var(--text-secondary);
      margin-top: 16px;
      font-weight: 400;
      max-width: 340px;
      margin-left: auto;
      margin-right: auto;
      animation: fadeUp 0.5s 0.25s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    @keyframes fadeUp {
      from {
        opacity: 0;
        transform: translateY(8px);
      }
    }

    /* ===== Sections ===== */
    .card__section {
      padding: 0 28px;
      margin-bottom: 24px;
      animation: fadeUp 0.5s 0.3s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    .card__section-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      font-weight: 600;
      color: var(--text-tertiary);
      margin-bottom: 10px;
      padding-left: 2px;
    }

    .card__divider {
      height: 1px;
      background: var(--divider);
      margin: 0 28px 24px;
    }

    /* ===== Contact rows ===== */
    .card__contact {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 11px 14px;
      margin: 0 -14px;
      border-radius: 12px;
      text-decoration: none;
      color: inherit;
      transition: background 0.2s ease;
    }

    .card__contact:hover {
      background: var(--primary-soft);
    }

    .card__contact-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.8px;
      font-weight: 500;
      color: var(--text-tertiary);
      flex-shrink: 0;
    }

    .card__contact-right {
      display: flex;
      align-items: center;
      gap: 6px;
      min-width: 0;
    }

    .card__contact-value {
      font-size: 14px;
      font-weight: 500;
      color: var(--primary-color, #0066cc);
      text-align: right;
      word-break: break-all;
    }

    .card__copy {
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      color: var(--text-tertiary);
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .card__copy:hover {
      background: var(--primary-soft);
      color: var(--primary-color, #0066cc);
    }

    .card__copy--done {
      color: #22c55e !important;
    }

    .card__copy--done .card__copy-icon { display: none; }
    .card__copy--done .card__copy-check { display: inline; }
    .card__copy-check { display: none; }

    .card__contact-value--link {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      word-break: break-all;
    }

    .card__website-icon {
      flex-shrink: 0;
      opacity: 0.4;
    }

    /* ===== Address ===== */
    .card__address {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
      font-weight: 400;
      text-align: right;
    }

    /* ===== Social links ===== */
    .card__socials {
      padding: 0 28px;
      margin-bottom: 28px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      animation: fadeUp 0.5s 0.35s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    .card__social {
      display: inline-flex;
      align-items: center;
      padding: 7px 14px;
      border-radius: 100px;
      border: 1px solid var(--divider);
      background: transparent;
      text-decoration: none;
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 500;
      letter-spacing: 0.3px;
      text-transform: capitalize;
      transition: all 0.2s ease;
    }

    .card__social:hover {
      border-color: var(--primary-color, #0066cc);
      color: var(--primary-color, #0066cc);
      background: var(--primary-soft);
      transform: translateY(-1px);
    }

    /* ===== Footer ===== */
    .card__footer {
      padding: 16px 28px 20px;
      text-align: center;
      font-size: 12px;
      color: var(--text-tertiary);
    }

    .card__footer a {
      color: var(--primary-color, #0066cc);
      text-decoration: none;
      font-weight: 500;
    }

    .card__footer a:hover {
      text-decoration: underline;
    }

    /* ===== Actions ===== */
    .card__actions {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      gap: 10px;
      padding: 16px 20px calc(16px + env(safe-area-inset-bottom, 0px));
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(20px) saturate(1.5);
      -webkit-backdrop-filter: blur(20px) saturate(1.5);
      border-top: 1px solid rgba(0,0,0,0.06);
      z-index: 10;
      justify-content: center;
      animation: slideUp 0.4s 0.5s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    html.theme-dark .card__actions {
      background: rgba(30,30,30,0.85);
      border-top-color: rgba(255,255,255,0.08);
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(100%);
      }
    }

    .card__actions-inner {
      display: flex;
      gap: 10px;
      max-width: 460px;
      width: 100%;
    }

    .btn {
      flex: 1;
      padding: 13px 20px;
      border-radius: 14px;
      font-family: var(--font-body);
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      text-decoration: none;
      cursor: pointer;
      border: none;
      transition: all 0.2s ease;
      letter-spacing: 0.02em;
    }

    .btn:active {
      transform: scale(0.97);
    }

    .btn-primary {
      background: var(--primary-color, #0066cc);
      color: white;
      box-shadow: 0 2px 8px color-mix(in srgb, var(--primary-color, #0066cc) 30%, transparent);
    }

    .btn-primary:hover {
      box-shadow: 0 4px 16px color-mix(in srgb, var(--primary-color, #0066cc) 40%, transparent);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: var(--primary-soft);
      color: var(--primary-color, #0066cc);
    }

    .btn-secondary:hover {
      background: var(--primary-medium);
    }

    /* ===== AUTO theme: follow system preference ===== */
    @media (prefers-color-scheme: dark) {
      html.theme-auto {
        --bg-color: var(--bg-color-dark, #1e1e1e);
        --text-color: var(--text-color-dark, #ffffff);
        --primary-soft: color-mix(in srgb, var(--primary-color, #0066cc) 10%, var(--bg-color));
        --primary-medium: color-mix(in srgb, var(--primary-color, #0066cc) 18%, var(--bg-color));
        --divider: color-mix(in srgb, var(--text-color) 10%, var(--bg-color));
        --text-secondary: color-mix(in srgb, var(--text-color) 65%, var(--bg-color));
        --text-tertiary: color-mix(in srgb, var(--text-color) 45%, var(--bg-color));
      }

      html.theme-auto body {
        background-color: var(--bg-color, #111);
        color: var(--text-color, #f0f0f0);
      }

      html.theme-auto .card {
        box-shadow:
          0 0 0 1px rgba(255,255,255,0.06),
          0 8px 24px rgba(0,0,0,0.3),
          0 24px 48px rgba(0,0,0,0.2);
      }

      html.theme-auto .card__actions {
        background: rgba(30,30,30,0.85);
        border-top-color: rgba(255,255,255,0.08);
      }
    }

    /* ===== Responsive ===== */
    @media (max-width: 500px) {
      body {
        padding: 0 0 120px;
      }

      .card {
        border-radius: 0;
        box-shadow: none;
        max-width: 100%;
      }

      .card__banner {
        height: 160px;
      }

      .card__name {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <!-- Banner -->
    <div class="card__banner">
      {{#if card.bannerPath}}
      <img src="{{card.bannerPath}}" alt="Banner">
      {{/if}}
    </div>

    <!-- Profile -->
    <div class="card__profile">
      {{#if card.avatarPath}}
      <img
        src="{{card.avatarPath}}"
        alt="{{card.name}}"
        class="card__avatar {{card.avatarShapeClass}}"
      >
      {{else}}
      <div class="card__avatar-ph {{card.avatarShapeClass}}">
        {{card.nameInitial}}
      </div>
      {{/if}}

      <h1 class="card__name">{{card.name}}</h1>

      {{#if card.jobTitle}}
      <p class="card__role">
        {{card.jobTitle}}{{#if card.company}} <span style="opacity:0.4">&middot;</span> <strong>{{card.company}}</strong>{{/if}}
      </p>
      {{else}}
        {{#if card.company}}
        <p class="card__role"><strong>{{card.company}}</strong></p>
        {{/if}}
      {{/if}}

      {{#if card.bio}}
      <p class="card__bio">{{card.bio}}</p>
      {{/if}}
    </div>

    <!-- Phones -->
    {{#if card.phones}}
    <div class="card__divider"></div>
    <div class="card__section">
      {{#each card.phones}}
      {{#if ../obfuscate}}
      <a href="#" class="card__contact card__contact--ob" data-ob-href="{{this.encodedHref}}" data-ob-text="{{this.encodedValue}}">
        <span class="card__contact-label">{{#if this.label}}{{this.label}}{{else}}Phone{{/if}}</span>
        <span class="card__contact-right">
          <span class="card__contact-value">{{this.masked}}</span>
          <span class="card__copy" data-copy-ob="{{this.encodedValue}}" role="button"><svg class="card__copy-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><svg class="card__copy-check" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></span>
        </span>
      </a>
      {{else}}
      <a href="tel:{{this.number}}" class="card__contact">
        <span class="card__contact-label">{{#if this.label}}{{this.label}}{{else}}Phone{{/if}}</span>
        <span class="card__contact-right">
          <span class="card__contact-value">{{this.number}}</span>
          <span class="card__copy" data-copy="{{this.number}}" role="button"><svg class="card__copy-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><svg class="card__copy-check" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></span>
        </span>
      </a>
      {{/if}}
      {{/each}}
    </div>
    {{/if}}

    <!-- Emails -->
    {{#if card.emails}}
    {{#unless card.phones}}<div class="card__divider"></div>{{/unless}}
    <div class="card__section">
      {{#each card.emails}}
      {{#if ../obfuscate}}
      <a href="#" class="card__contact card__contact--ob" data-ob-href="{{this.encodedHref}}" data-ob-text="{{this.encodedValue}}">
        <span class="card__contact-label">{{#if this.label}}{{this.label}}{{else}}Email{{/if}}</span>
        <span class="card__contact-right">
          <span class="card__contact-value">{{this.masked}}</span>
          <span class="card__copy" data-copy-ob="{{this.encodedValue}}" role="button"><svg class="card__copy-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><svg class="card__copy-check" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></span>
        </span>
      </a>
      {{else}}
      <a href="mailto:{{this.email}}" class="card__contact">
        <span class="card__contact-label">{{#if this.label}}{{this.label}}{{else}}Email{{/if}}</span>
        <span class="card__contact-right">
          <span class="card__contact-value">{{this.email}}</span>
          <span class="card__copy" data-copy="{{this.email}}" role="button"><svg class="card__copy-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg><svg class="card__copy-check" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg></span>
        </span>
      </a>
      {{/if}}
      {{/each}}
    </div>
    {{/if}}

    <!-- Websites -->
    {{#if card.websites}}
    <div class="card__divider"></div>
    <div class="card__section">
      {{#each card.websites}}
      <a href="{{this.url}}" target="_blank" rel="noopener noreferrer" class="card__contact">
        <span class="card__contact-label">{{#if this.label}}{{this.label}}{{else}}Website{{/if}}</span>
        <span class="card__contact-value card__contact-value--link">
          {{this.url}}
          <svg class="card__website-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
        </span>
      </a>
      {{/each}}
    </div>
    {{/if}}

    <!-- Address -->
    {{#if card.address}}
    <div class="card__divider"></div>
    <div class="card__section">
      <div class="card__contact">
        <span class="card__contact-label">Address</span>
        <span class="card__address">
          {{#if card.address.street}}{{card.address.street}}<br>{{/if}}
          {{#if card.address.city}}{{card.address.city}}{{/if}}{{#if card.address.zip}} {{card.address.zip}}{{/if}}
          {{#if card.address.country}}<br>{{card.address.country}}{{/if}}
        </span>
      </div>
    </div>
    {{/if}}

    <!-- Social Links -->
    {{#if card.socialLinks}}
    <div class="card__divider"></div>
    <div class="card__socials">
      {{#each card.socialLinks}}
      <a href="{{this.url}}" target="_blank" rel="noopener noreferrer" class="card__social">
        {{this.platform}}
      </a>
      {{/each}}
    </div>
    {{/if}}

    <!-- Footer -->
    {{#if footerText}}
    <div class="card__footer">
      {{#if footerLink}}
        <a href="{{footerLink}}" target="_blank" rel="noopener noreferrer">{{footerText}}</a>
      {{else}}
        <span>{{footerText}}</span>
      {{/if}}
    </div>
    {{else}}
      {{#if footerLink}}
      <div class="card__footer">
        <a href="{{footerLink}}" target="_blank" rel="noopener noreferrer">{{footerLink}}</a>
      </div>
      {{/if}}
    {{/if}}
  </div>

  <!-- Sticky action bar -->
  <div class="card__actions">
    <div class="card__actions-inner">
      <a href="{{vcfUrl}}" class="btn btn-primary" download>Save Contact</a>
      <button type="button" class="btn btn-secondary" id="share-btn">Share</button>
    </div>
  </div>

  <script>
    // View tracking
    (function() {
      try {
        fetch('/api/cards/{{card.slug}}/view', { method: 'POST' });
      } catch (e) { /* silent */ }
    })();

    // Deobfuscate contact info
    document.querySelectorAll('.card__contact--ob').forEach(function(el) {
      var href = el.getAttribute('data-ob-href');
      var text = el.getAttribute('data-ob-text');
      if (href) el.setAttribute('href', atob(href));
      if (text) el.querySelector('.card__contact-value').textContent = atob(text);
      el.classList.remove('card__contact--ob');
      el.removeAttribute('data-ob-href');
      el.removeAttribute('data-ob-text');
      var copyBtn = el.querySelector('[data-copy-ob]');
      if (copyBtn) {
        copyBtn.setAttribute('data-copy', atob(copyBtn.getAttribute('data-copy-ob')));
        copyBtn.removeAttribute('data-copy-ob');
      }
    });

    // Copy to clipboard
    document.addEventListener('click', function(e) {
      var btn = e.target.closest('.card__copy');
      if (!btn) return;
      e.preventDefault();
      e.stopPropagation();
      var text = btn.getAttribute('data-copy');
      if (!text) return;
      navigator.clipboard.writeText(text).then(function() {
        btn.classList.add('card__copy--done');
        setTimeout(function() {
          btn.classList.remove('card__copy--done');
        }, 1500);
      });
    });

    // Share functionality
    document.getElementById('share-btn').addEventListener('click', function() {
      var url = '{{cardUrl}}';
      var title = '{{og.title}}';
      if (navigator.share) {
        navigator.share({ title: title, url: url }).catch(function() {});
      } else {
        navigator.clipboard.writeText(url).then(function() {
          var btn = document.getElementById('share-btn');
          btn.textContent = 'Copied!';
          setTimeout(function() { btn.textContent = 'Share'; }, 2000);
        }).catch(function() {
          prompt('Copy this link:', url);
        });
      }
    });
  </script>
</body>
</html>
